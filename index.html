<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>世界遺産マップ</title>
  <style>
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden; /* ← スクロールバーをなくす */
  }

  #map {
    height: 100vh;
    width: 100%;
  }

  .gm-ui-hover-effect {
    display: none !important; /* Closeボタン非表示 */
  }

  .custom-marker {
    background-color: orange;
    color: white;
    font-size: 10px;
    border-radius: 50%;
    padding: 4px;
    border: 1px solid white;
    text-align: center;
    width: 24px;
    height: 24px;
    line-height: 16px;
    font-weight: bold;
  }
</style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCZPRJzf-rbyrdjWjmJYWYpb74dnfLjkHw&callback=initMap" async defer></script>
</head>
<body>
  <div id="map"></div>
  <script>
    let map;
    let openInfoWindow = null;
    const lastCenterKey = "mapCenter";
    const lastZoomKey = "mapZoom";

    function initMap() {
      const savedCenter = JSON.parse(localStorage.getItem(lastCenterKey));
      const savedZoom = parseInt(localStorage.getItem(lastZoomKey));

      map = new google.maps.Map(document.getElementById("map"), {
        zoom: savedZoom || 3,
        center: savedCenter || { lat: 20, lng: 0 },
      });

      map.addListener("idle", () => {
        const center = map.getCenter();
        localStorage.setItem(lastCenterKey, JSON.stringify({ lat: center.lat(), lng: center.lng() }));
        localStorage.setItem(lastZoomKey, map.getZoom());
      });

      fetch(location.pathname.replace(/\/[^\/]*$/, '/') + 'places.csv')
        .then(response => response.text())
        .then(text => {
          const rows = text.trim().split("\n");
          rows.shift(); // skip header
          const countryCounters = {};

          rows.forEach(row => {
            const [country, name, latStr, lngStr] = row.split(",");
            const lat = parseFloat(latStr);
            const lng = parseFloat(lngStr);
            if (isNaN(lat) || isNaN(lng)) return;

            if (!countryCounters[country]) {
              countryCounters[country] = 1;
            } else {
              countryCounters[country]++;
            }
            const number = countryCounters[country];

            // カスタムマーカーを画像として作成
            const canvas = document.createElement("canvas");
            canvas.width = 30;
            canvas.height = 30;
            const ctx = canvas.getContext("2d");
            ctx.beginPath();
            ctx.arc(15, 15, 12, 0, 2 * Math.PI);
            ctx.fillStyle = "orange";
            ctx.fill();
            ctx.strokeStyle = "white";
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.fillStyle = "white";
            ctx.font = "bold 12px sans-serif";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(number, 15, 15);
            const markerIcon = {
              url: canvas.toDataURL(),
              scaledSize: new google.maps.Size(24, 24)
            };

            const marker = new google.maps.Marker({
              position: { lat, lng },
              map,
              icon: markerIcon,
            });

            const infoWindow = new google.maps.InfoWindow({
              content: name.trim()
            });

            marker.addListener("click", () => {
  if (openInfoWindow === infoWindow) {
    infoWindow.close();
    openInfoWindow = null;
  } else {
    if (openInfoWindow) {
      openInfoWindow.close();
    }
    infoWindow.open({ anchor: marker, map });
    openInfoWindow = infoWindow;
  }
            });
          });
        });
    }
  </script>
</body>
</html>


