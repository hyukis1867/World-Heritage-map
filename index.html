<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>世界遺産マップ</title>
    <style>
      #map {
        height: 100vh;
        width: 100%;
      }
    </style>
    <!-- CSVパース用 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <!-- Google Maps API -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"
      defer
    ></script>
  </head>
  <body>
    <div id="map"></div>

    <script>
      let map;
      const markerMap = new Map(); // ID → [marker, marker, ...]

      async function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 20.0, lng: 0.0 },
          zoom: 2,
        });

        const response = await fetch("heritage.csv");
        const csvText = await response.text();
        const data = Papa.parse(csvText, { header: true }).data;

        for (const row of data) {
          const id = row["ID"];
          const lat = parseFloat(row["緯度"]);
          const lng = parseFloat(row["経度"]);
          const title = row["遺産名"];
          const year = row["登録年"];
          const type = row["タイプ"];
          const siteNameJP = row["現地名(JP)"];
          const siteNameEN = row["現地名（EN）"];
          const url = row["URL"];

          if (!lat || !lng || !id) continue;

          const marker = new google.maps.Marker({
            position: { lat, lng },
            map,
            label: id,
            title,
            icon: {
              path: google.maps.SymbolPath.CIRCLE,
              scale: 6,
              fillColor: "#ff5722",
              fillOpacity: 0.9,
              strokeWeight: 1,
            },
          });

          const infoWindow = new google.maps.InfoWindow({
            content: `
              <div>
                <strong>${title}</strong><br>
                ${siteNameJP || ""}<br>
                ${siteNameEN || ""}<br>
                <small>${type} / ${year}</small><br>
                ${url ? `<a href="${url}" target="_blank">詳細</a>` : ""}
              </div>
            `,
          });

          marker.addListener("click", () => {
            infoWindow.open(map, marker);
          });

          // IDに基づき markerMap に複数マーカー格納
          if (!markerMap.has(id)) markerMap.set(id, []);
          markerMap.get(id).push(marker);
        }
      }

      // 検索などから呼び出す：IDでジャンプ
      function focusOnHeritage(id) {
        const markers = markerMap.get(id);
        if (markers && markers.length > 0) {
          const marker = markers[0]; // 最初のマーカーにだけ注目
          map.setZoom(8);
          map.panTo(marker.getPosition());
          google.maps.event.trigger(marker, "click");
        }
      }

      window.initMap = initMap;
      window.focusOnHeritage = focusOnHeritage; // 外部から呼び出し可能に
    </script>
  </body>
</html>


