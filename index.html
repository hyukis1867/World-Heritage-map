<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>世界遺産</title>
  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    let map;
    const markers = [];
    const infoWindows = [];

    function initMap() {
      // 前回の中心座標を localStorage から読み込む
      const savedLat = parseFloat(localStorage.getItem("mapLat"));
      const savedLng = parseFloat(localStorage.getItem("mapLng"));
      const savedZoom = parseInt(localStorage.getItem("mapZoom"), 10);

      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: savedLat || 48.8566, lng: savedLng || 2.3522 },
        zoom: savedZoom || 2,
        mapTypeId: 'roadmap'
      });

      // 座標保存
      map.addListener("idle", () => {
        const center = map.getCenter();
        localStorage.setItem("mapLat", center.lat());
        localStorage.setItem("mapLng", center.lng());
        localStorage.setItem("mapZoom", map.getZoom());
      });

      fetch("places.csv")
        .then(response => response.text())
        .then(data => {
          const lines = data.trim().split("\n");
          lines.forEach((line, index) => {
            const [place, latStr, lngStr] = line.split(",");
            const lat = parseFloat(latStr);
            const lng = parseFloat(lngStr);

            if (!isNaN(lat) && !isNaN(lng)) {
              const position = { lat, lng };

              // オレンジ色のマーカーアイコン（番号付き）
              const label = String.fromCharCode(65 + (index % 26)); // A, B, C...
              const marker = new google.maps.Marker({
                position,
                map,
                icon: {
                  url: "http://maps.google.com/mapfiles/ms/icons/orange-dot.png",
                  scaledSize: new google.maps.Size(32, 32)
                },
                label: {
                  text: label,
                  color: "white",
                  fontSize: "12px",
                  fontWeight: "bold"
                }
              });

              const infoWindow = new google.maps.InfoWindow({
                content: `<div style="font-size:14px;">${place}</div>`,
                disableAutoPan: false
              });

              // 吹き出しトグル表示
              marker.addListener("click", () => {
                if (infoWindow.getMap()) {
                  infoWindow.close();
                } else {
                  infoWindows.forEach(iw => iw.close());
                  infoWindow.open(map, marker);
                }
              });

              markers.push(marker);
              infoWindows.push(infoWindow);
            }
          });
        });
    }
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCZPRJzf-rbyrdjWjmJYWYpb74dnfLjkHw&callback=initMap">
  </script>
</body>
</html>


